<% provide(:title,  'Tasks') %>

<div class="pull-right title-search-form">
  <form action="/tasks" class="form-search" method="GET">
    <input name="title" type="text" class="input-medium search-query">
    <button type="submit" class="btn">Search</button>
  </form>
</div>
<div class="task-list-main">
  <table class="table">
    <caption><strong>Task List</strong></caption>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th><%= link_to 'Due Date', {:action=>'index', :timing => 1}, :title => 'Sort by Due Date' %></th>
        <th><%= link_to 'Priority', {:action=>'index', :priority => 1}, :title => 'Sort by Priority' %></th>
        <th>Status</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% unless @tasks.nil? || @tasks.empty? %>
        <% @tasks.each do |task| %>
        <tr>
          <td><%= task.id %></td>
          <td><%= task.title %></td>
          <td><%= task.timing %></td>
          <td><%= task.priority %></td>
          <td>
              <% if is_over_due(task.timing) %>
                <%= "OverDue" %>
              <% elsif task.status %>
                <%= "Completed" %>
              <% else %>
                <%= "Pending" %>
              <% end %>
          </td>
          <td>
              <% if task.description.empty? %>
                  <%= "No Description" %>
              <% else %>
                  <%= task.description %>
              <% end %>
          </td>
          <td>
            <%= link_to "Edit", edit_task_path(task), :title => 'Delete this task' %> | 
            <%= link_to 'Delete', { :action => 'destroy', :id => task.id }, :confirm=>"Are you sure", :method=>:delete, :title => 'Delete this task' %>
          </td>
        </tr>
        <% end -%>
      <% end %>
    </tbody>
  </table>
</div>
<%= link_to "Create Task", new_task_path, class: "btn btn-large btn-primary" %>
<div class = "pull-right">
  <%= link_to "Filter OverDue Tasks", {:action=>'index', :overdue => 1}, :title => 'Filter by Status' %> |
  <%= link_to "List All Tasks", tasks_path, :title => 'All Tasks' %>
</div>